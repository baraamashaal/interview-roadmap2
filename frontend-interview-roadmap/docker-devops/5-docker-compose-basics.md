
# 5. Docker Compose Basics

## Quick Revision

**Docker Compose** is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file (`docker-compose.yml`) to configure your application's services, networks, and volumes. Then, with a single command, you can create and start all the services from your configuration.

## Detailed Explanation

Many applications are not single-container applications. A typical web application might consist of a frontend, a backend API, and a database. Managing these multiple containers individually can be complex.

Docker Compose simplifies this by allowing you to define your entire application stack in a single file. It orchestrates the creation, networking, and linking of these services.

### Key Concepts

1.  **Services:** Each service in a `docker-compose.yml` file represents a container. You define the image to use, ports to expose, volumes to mount, and other configurations for each service.

2.  **Networks:** Compose automatically sets up a default network for your application, allowing services to communicate with each other using their service names as hostnames.

3.  **Volumes:** Volumes are used to persist data generated by Docker containers. They can be used to share code between your host and the container (for development) or to store database data.

### `docker-compose.yml` Structure

```yaml
version: '3.8' # Specify the Compose file format version
services:
  web:
    build: .
    ports:
      - "3000:3000"
    volumes:
      - .:/app
    depends_on:
      - api
  api:
    image: my-backend-api-image
    ports:
      - "5000:5000"
  db:
    image: postgres
    volumes:
      - db-data:/var/lib/postgresql/data
volumes:
  db-data:
```

### Common Docker Compose Commands

*   **`docker-compose up`:** Builds, creates, starts, and attaches to containers for all services.
*   **`docker-compose up -d`:** Runs containers in detached mode (in the background).
*   **`docker-compose down`:** Stops and removes containers, networks, and volumes.
*   **`docker-compose build`:** Builds or rebuilds services.
*   **`docker-compose ps`:** Lists all running services.

## Code Example

### `docker-compose.yml` for a Frontend (React) and Backend (Node.js) Application

Let's assume you have a React frontend in the current directory and a Node.js backend in a `backend/` subdirectory.

```yaml
# docker-compose.yml
version: '3.8'
services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    ports:
      - "3000:80" # Map host port 3000 to container port 80 (Nginx)
    volumes:
      - .:/app # Mount current directory for development (optional)
    depends_on:
      - backend

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.backend
    ports:
      - "5000:5000"
    volumes:
      - ./backend:/app # Mount backend directory for development (optional)
    environment:
      NODE_ENV: development
      DATABASE_URL: postgres://user:password@db:5432/mydb
    depends_on:
      - db

  db:
    image: postgres:13
    environment:
      POSTGRES_DB: mydb
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    volumes:
      - db-data:/var/lib/postgresql/data

volumes:
  db-data:
```

**`Dockerfile.frontend` (for React app):**

```dockerfile
# Dockerfile.frontend
FROM node:18-alpine AS builder
WORKDIR /app
COPY package.json yarn.lock ./
RUN yarn install --frozen-lockfile
COPY . .
RUN yarn build

FROM nginx:stable-alpine AS runner
COPY --from=builder /app/build /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

**`Dockerfile.backend` (for Node.js app):**

```dockerfile
# Dockerfile.backend
FROM node:18-alpine
WORKDIR /app
COPY backend/package.json backend/yarn.lock ./
RUN yarn install --frozen-lockfile
COPY backend/. .
EXPOSE 5000
CMD ["node", "server.js"]
```

**To run this application stack:**

1.  Place `docker-compose.yml` in your project root.
2.  Create `Dockerfile.frontend` and `Dockerfile.backend` as shown.
3.  Run `docker-compose up -d`.

## Resources

*   **Official Docs:** [Docker Compose Overview](https://docs.docker.com/compose/)
*   **Documentation:** [Compose file version 3 reference](https://docs.docker.com/compose/compose-file/compose-file-v3/)
*   **Video:** [Docker Compose Crash Course - Traversy Media](https://www.youtube.com/watch?v=static-relative-absolute-fixed-sticky)
