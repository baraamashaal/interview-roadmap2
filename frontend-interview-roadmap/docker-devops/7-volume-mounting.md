
# 7. Volume Mounting in Docker

## Quick Revision

**Volume mounting** in Docker is a mechanism to persist data generated by and used by Docker containers. It allows you to store data outside the container's writable layer, making it independent of the container's lifecycle. This is crucial for:

*   **Data Persistence:** Ensuring data is not lost when a container is removed or recreated.
*   **Sharing Data:** Sharing files or directories between the host machine and the container, or between multiple containers.
*   **Development Workflow:** Enabling live code changes in development by mounting your local source code into the container.

## Detailed Explanation

By default, data inside a container is ephemeral; it is lost when the container is removed. Volumes provide a way to store data persistently.

Docker offers several types of mounts:

### 1. Bind Mounts

*   **How it works:** A bind mount mounts a file or directory from the host machine into a container. The host machine's file system structure is directly reflected inside the container.
*   **Use Cases:**
    *   **Development:** Mounting your source code into a container so that changes on your host machine are immediately reflected in the running container (e.g., for hot-reloading).
    *   **Configuration:** Providing configuration files to a container.
*   **Syntax:**
    *   `docker run -v /path/on/host:/path/in/container ...`
    *   In `docker-compose.yml`: `volumes: - /path/on/host:/path/in/container`

### 2. Docker Volumes (Managed Volumes)

*   **How it works:** Docker creates and manages these volumes. They are stored in a part of the host filesystem managed by Docker (`/var/lib/docker/volumes/` on Linux) and are not directly accessible by non-Docker processes.
*   **Use Cases:**
    *   **Database Storage:** Ideal for persisting database data, as Docker handles the underlying storage.
    *   **Data Sharing:** Sharing data between multiple containers.
*   **Syntax:**
    *   `docker run -v my-volume:/path/in/container ...`
    *   In `docker-compose.yml`:

        ```yaml
        services:
          my-service:
            volumes:
              - my-volume:/path/in/container
        volumes:
          my-volume:
        ```

### 3. `tmpfs` Mounts

*   **How it works:** Mounts a temporary file system into the container's memory. Data is not persisted to disk and is lost when the container stops.
*   **Use Cases:** For sensitive data that should not be written to disk, or for temporary data that doesn't need to be persisted.
*   **Syntax:** `docker run --tmpfs /path/in/container ...`

## Code Examples

### Bind Mount for Frontend Development

```yaml
# docker-compose.yml
version: '3.8'
services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    ports:
      - "3000:3000"
    volumes:
      - .:/app # Mount current host directory to /app in container
      - /app/node_modules # Exclude node_modules from being overwritten by host mount
    environment:
      CHOKIDAR_USEPOLLING: "true" # For some hot-reloading setups
```

**Explanation:**

*   `.:/app`: Mounts your local project directory into the container's `/app` directory. Any changes you make locally will be immediately reflected in the container.
*   `/app/node_modules`: This is a common trick. When you bind mount your entire project directory, the `node_modules` folder from your host might overwrite the one installed in the container. This anonymous volume ensures that the `node_modules` directory inside the container remains separate and uses the dependencies installed during the Docker build.

### Docker Volume for Database Persistence

```yaml
# docker-compose.yml
version: '3.8'
services:
  db:
    image: postgres:13
    environment:
      POSTGRES_DB: mydb
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    volumes:
      - db-data:/var/lib/postgresql/data # Mount a named Docker volume

volumes:
  db-data: # Define the named volume
```

## Resources

*   **Article:** [Docker Docs - Use volumes](https://docs.docker.com/storage/volumes/)
*   **Article:** [Docker Docs - Bind mounts](https://docs.docker.com/storage/bind-mounts/)
*   **Video:** [Docker Volumes Explained - Traversy Media](https://www.youtube.com/watch?v=static-relative-absolute-fixed-sticky)
